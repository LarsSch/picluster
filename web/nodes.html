<html>
<head>
	<script src="/assets/jquery.min.js"></script>
	<link rel="stylesheet" href="/assets/jquery-ui.css">
	<script src="/assets/jquery-ui.js"></script>
	<script src="/assets/distLogo.js"></script>
	<link rel="stylesheet" href="/assets/circle.css">
	<link rel="stylesheet" href="/assets/picluster-iframe.css">
	<script>
		function exec() {
			var div = document.getElementById('modal-body2');
			div ? div.innerHTML = div.innerHTML + '<br><p align=center><img heigth="200" width="200" src="/assets/images/searching.jpg"><br><font size=+3><label>Searching for nodes</label></font>' : div;

			$.get("/nodes?token=" + parent.token, function(data) {
				var check_data = data;
				div ? div.innerHTML = '' : div;

				for (var i in check_data.data) {
					if (div) {
						var dist = (check_data.data[i].os_type || '').toLowerCase();
						var div_logo_page = document.createElement('div_logo_page_class');
						div_logo_page.innerHTML = '<p class="node_status_text">' + check_data.data[i].hostname + "</p><br>" + distLogo(dist);

						var div_disk_page = document.createElement('div_disk_page');
						div_disk_page.className = "page";

						var div_disk_clearfix = document.createElement('div_disk_clearfix');
						div_disk_clearfix.className = 'clearfix';
						div_disk_clearfix.id = 'div_disk_clearfix';

						var div_disk_running_class = document.createElement('div_disk_running_class');
						div_disk_running_class.className = 'c100 p' + Math.round(check_data.data[i].disk_percentage) + ' small';
						div_disk_running_class.id = 'running-class';
						div_disk_running_class.innerHTML = '<span id="' + check_data.data[i] + '">' + Math.round(check_data.data[i].disk_percentage) + '%</span>';

						var div_disk_slice = document.createElement('div_disk_slice');
						div_disk_slice.className = "slice";

						var div_disk_bar = document.createElement('div_disk_bar');
						div_disk_bar.className = "bar";

						var div_disk_fill = document.createElement('div_disk_fill');
						div_disk_fill.className = "fill";

						var div_cpu_page = document.createElement('div_cpu_page');
						div_cpu_page.className = "page";

						var div_cpu_clearfix = document.createElement('div_cpu_clearfix');
						div_cpu_clearfix.className = 'clearfix';
						div_cpu_clearfix.id = 'div_cpu_clearfix';

						var div_cpu_running_class = document.createElement('div_cpu_running_class');
						div_cpu_running_class.className = 'c100 p' + Math.round(check_data.data[i].cpu_percent / check_data.data[i].cpu_cores) + ' small';
						div_cpu_running_class.id = 'running-class';
						div_cpu_running_class.innerHTML = '<span id="' + i + '">' + Math.round(check_data.data[i].cpu_percent / check_data.data[i].cpu_cores) + '%</span>';

						var div_cpu_slice = document.createElement('div_cpu_slice');
						div_cpu_slice.className = "slice";

						var div_cpu_bar = document.createElement('div_cpu_bar');
						div_cpu_bar.className = "bar";

						var div_cpu_fill = document.createElement('div_cpu_fill');
						div_cpu_fill.className = "fill";

						var div_memory_page = document.createElement('div_memory_page');
						div_memory_page.className = "page";

						var div_memory_clearfix = document.createElement('div_memory_clearfix');
						div_memory_clearfix.className = 'clearfix';
						div_memory_clearfix.id = 'div_memory_clearfix';

						var div_memory_running_class = document.createElement('div_memory_running_class');
						div_memory_running_class.className = 'c100 p' + check_data.data[i].memory_percentage + ' small';
						div_memory_running_class.id = 'running-class';
						div_memory_running_class.innerHTML = '<span id="' + i + '">' + check_data.data[i].memory_percentage + '%</span>';

						var div_memory_slice = document.createElement('div_memory_slice');
						div_memory_slice.className = "slice";

						var div_memory_bar = document.createElement('div_memory_bar');
						div_memory_bar.className = "bar";

						var div_memory_fill = document.createElement('div_memory_fill');
						div_memory_fill.className = "fill";

						div_disk_page.appendChild(div_disk_clearfix);
						div_disk_clearfix.appendChild(div_disk_running_class);
						div_disk_running_class.appendChild(div_disk_slice);
						div_disk_slice.appendChild(div_disk_bar);
						div_disk_bar.appendChild(div_disk_fill);

						div_cpu_page.appendChild(div_cpu_clearfix);
						div_cpu_clearfix.appendChild(div_cpu_running_class);
						div_cpu_running_class.appendChild(div_cpu_slice);
						div_cpu_slice.appendChild(div_cpu_bar);
						div_cpu_bar.appendChild(div_cpu_fill);

						div_memory_page.appendChild(div_memory_clearfix);
						div_memory_clearfix.appendChild(div_memory_running_class);
						div_memory_running_class.appendChild(div_memory_slice);
						div_memory_slice.appendChild(div_memory_bar);
						div_memory_bar.appendChild(div_memory_fill);

						var table = document.createElement("table");
						var line_break = document.createElement("br");
						var row = table.insertRow(0);
						var cell_logo_page = row.insertCell(0)
						var cell_disk_usage = row.insertCell(1);
						var cell_cpu_usage = row.insertCell(2);
						var cell_memory_usage = row.insertCell(3);
						table.className = "node_card";
						cell_disk_usage.innerHTML += '<font size="+0" color="black"><b>Disk Usage</b>';
						cell_cpu_usage.innerHTML += '<font size="+0" color="black"><b>CPU Usage</b>';
						cell_memory_usage.innerHTML += '<font size="+0" color="black"><b>Memory Usage</b>';
						cell_logo_page.appendChild(div_logo_page);
						cell_disk_usage.appendChild(div_disk_page);
						cell_cpu_usage.appendChild(div_cpu_page);
						cell_memory_usage.appendChild(div_memory_page);
						div.appendChild(table);
						div.appendChild(line_break);
					}
				}
				addFontLinux();
			});
		}
	</script>
</head>

<body>
	<div id="output" class="modal">
		<div class="modal-content modal-medium">
			<div class="modal-header">
				<span class="close">&times;</span>
				<h2>PiCluster Nodes</h2>
			</div>

			<div id="modal-body2" class="modal-body">
				<p align=center></p>
			</div>
		</div>
	</div>

	<script>
	  var output_modal = document.getElementById('output');
	  var output_span = document.getElementsByClassName("close")[0];

	  output_span.onclick = function() {
		  output_modal.style.display = "none";
	  }

	  output_modal.style.display = "block";

		exec()

		parent.resize_iframe_height();
	</script>
</html>
